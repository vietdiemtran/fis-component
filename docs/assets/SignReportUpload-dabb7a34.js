var V=Object.defineProperty;var H=(c,l,u)=>l in c?V(c,l,{enumerable:!0,configurable:!0,writable:!0,value:u}):c[l]=u;var B=(c,l,u)=>(H(c,typeof l!="symbol"?l+"":l,u),u);import{R as r,c as a,F as $,j as T}from"./index-ac046c6e.js";import{u as A,s as E,M as z,P as G,D as K,p as L,C as W,V as J,a as Q,b as X,R as j,c as S,d as Y,B as Z,S as q,e as I,f as M,g as ee}from"./AppRoot-28bbac62.js";import{r as ae,cf as O,b4 as le}from"./http-37dced0c.js";class te extends ae.Model{constructor(){super(...arguments);B(this,"id");B(this,"code");B(this,"name");B(this,"fileTemplateInputs")}}function ne(c,l){switch(l.type){case 0:return{fileTemplates:[...l.data.fileTemplates],currentfileTemplate:{...l.data.currentfileTemplate},pdfBlobUrl:l.data.pdfBlobUrl};case 2:return{...c,fileTemplates:[...l.data.fileTemplates]};case 1:return{...c,currentfileTemplate:{...l.data.currentfileTemplate}};case 3:return{...c,pdfBlobUrl:l.data.pdfBlobUrl,currentFile:l.data.currentFile};case 4:return{...c,pdfBlobUrl:l.data.pdfBlobUrl,currentFile:l.data.currentFile,currentfileTemplate:{...l.data.currentfileTemplate}};default:return{...c}}}function ie(c,l,u,g,f,t,v){const[N]=A(),[U,s]=r.useState(!1),[h]=r.useState(v),[{fileTemplates:C,currentfileTemplate:o,pdfBlobUrl:d},y]=r.useReducer(ne,{fileTemplates:[],currentfileTemplate:new te,pdfBlobUrl:"",currentFile:null}),D=r.useCallback(()=>{const n={...o},e=t||void 0;s(!0),l({queryParams:e,template:n}).pipe(O.finalize(()=>s(!1))).subscribe({next:i=>{const p=new Blob([i.data],{type:"application/pdf"}),m=URL.createObjectURL(p);y({type:3,data:{pdfBlobUrl:m,currentFile:p}})}})},[o,t,l]),R=r.useCallback(()=>{const n={...o};u({template:n,queryParams:t||void 0}).subscribe({next:i=>{const p=i.headers["content-disposition"].split(";").find(b=>b.includes("filename=")).replace("filename=","").replace(/"/gi,"").trim(),m=window.URL.createObjectURL(new Blob([i.data],{type:"application/octet-stream"}));E(m,p)}})},[o,t,u]),x=r.useCallback(()=>{const n={...o};g({template:n,queryParams:t||void 0}).subscribe({next:i=>{const p=i.headers["content-disposition"].split(";").find(b=>b.includes("filename=")).replace("filename=","").replace(/"/gi,"").trim(),m=window.URL.createObjectURL(new Blob([i.data],{type:"application/octet-stream"}));E(m,p)}})},[o,t,g]),w=r.useCallback(n=>e=>{const i={...o};i.inputs[n].fieldValue=e,y({type:1,data:{currentfileTemplate:i}})},[o]),P=r.useCallback(n=>{const e={...o};e.name=n,y({type:1,data:{currentfileTemplate:e}})},[o]),k=r.useCallback(n=>{const e=Number(n.key),i=C.filter(m=>m.id===e)[0];s(!0),l({queryParams:t||void 0,template:i}).pipe(O.finalize(()=>s(!1))).subscribe({next:m=>{const b=new Blob([m.data],{type:"application/pdf"}),_=URL.createObjectURL(b);y({type:4,data:{currentfileTemplate:i,pdfBlobUrl:_,currentFile:b}})}})},[t,C,l]),F=r.useCallback(()=>{const n={...o},e=t||void 0;s(!0),l({queryParams:e,template:n}).pipe(O.finalize(()=>s(!1))).subscribe({next:i=>{const p=new Blob([i.data],{type:"application/pdf"}),m=URL.createObjectURL(p);y({type:3,data:{pdfBlobUrl:m,currentFile:p}}),f(p,n)}})},[o,t,l,f]);return r.useEffect(()=>{const n=c(t).subscribe({next:e=>{if(e&&e.length>0){const i=e,p=h??e[0];s(!0),y({type:0,data:{fileTemplates:i,currentfileTemplate:p}}),l({queryParams:t,template:p}).pipe(O.finalize(()=>s(!1))).subscribe({next:m=>{const b=new Blob([m.data],{type:"application/pdf"}),_=URL.createObjectURL(b);y({type:3,data:{pdfBlobUrl:_,currentFile:b}})}})}}});return()=>{n.unsubscribe()}},[t,h,c,l]),{currentfileTemplate:o,fileTemplates:C,pdfBlobUrl:d,loadingPdf:U,translate:N,handleChangeFileTemplateInputValue:w,handleChangeFileTemplateName:P,handleChangeFileTemplate:k,handlePreviewFileTemplate:D,handleDownloadFileTemplate:R,handleDownloadFileTemplateOriginal:x,handleSaveFileTemplate:F}}function re(c){const{getListFileTemplates:l,previewFileTemplate:u,downloadFileTemplatePdf:g,downloadFileTemplateOriginal:f,saveFileTemplate:t,subTitle:v,requestId:N,fileTemplate:U}=c,{currentfileTemplate:s,fileTemplates:h,pdfBlobUrl:C,loadingPdf:o,translate:d,handleChangeFileTemplateInputValue:y,handleChangeFileTemplateName:D,handleChangeFileTemplate:R,handlePreviewFileTemplate:x,handleDownloadFileTemplate:w,handleDownloadFileTemplateOriginal:P,handleSaveFileTemplate:k}=ie(l,u,g,f,t,N,U),F=r.useMemo(()=>{const n=s&&s.id?s.id.toString():null;return h&&h.length>0?a(z,{onClick:R,selectedKeys:[n],children:h.map(e=>a(z.Item,{children:e.name},e.id))}):a(z,{children:a(z.Item,{children:"Empty"},0)})},[s,h,R]);return a($,{children:T("div",{className:"page-content",children:[a(G,{title:d(v),breadcrumbs:[{name:d("fileTemplates.header")},{name:d(v)}]}),T("div",{className:"page page-detail page-detail--full p-t--lg p-l--md p-r--sm p-b--lg",children:[T("div",{className:"w-100 d-flex justify-content-between align-items-center",children:[a("div",{className:"page-detail__title",children:d("fileTemplates.title")}),T("div",{className:"d-flex align-items-center",children:[a(K,{dropdownRender:()=>F,trigger:["click"],children:a(L,{type:"secondary",className:"m-r--xs",size:"lg",icon:a(W,{size:16}),onClick:n=>{n.preventDefault()},children:d("fileTemplates.list")})}),a(L,{type:"secondary",className:"m-r--xs",size:"lg",icon:a(J,{size:16}),onClick:x,children:d("fileTemplates.preview")}),a(L,{type:"secondary",className:"m-r--xs",size:"lg",icon:a(Q,{size:16}),onClick:w,children:d("fileTemplates.downloadPDF")}),a(L,{type:"secondary",className:"m-r--xs",size:"lg",icon:a(X,{size:16}),onClick:P,children:d("fileTemplates.downloadFile")}),t&&a(L,{type:"primary",size:"lg",onClick:k,children:d("fileTemplates.save")})]})]}),a("div",{className:"w-100 mt-2",children:T(j,{gutter:[{xs:8,sm:16,md:24,lg:32},20],children:[a(S,{className:"gutter-row",span:10,children:T("div",{className:"gutter-box",children:[a(j,{gutter:[{xs:8,sm:16,md:24,lg:32},20],children:a(S,{lg:24,children:a(Y,{type:0,label:d("fileTemplates.name"),value:s.name,onChange:D})})}),a(j,{gutter:[{xs:8,sm:16,md:24,lg:32},20],children:s&&s.inputs!=null&&s.inputs.map((n,e)=>a(S,{lg:12,className:"m-t--xs",children:a(Z,{type:0,label:n.fieldName,onChange:y(e),value:n.fieldValue})},n.id))})]})}),a(S,{className:"gutter-row",span:14,children:a("div",{className:"d-flex w-100 justify-content-center align-items-center",style:{border:"1px solid black",height:650},children:o?a(q,{size:"large",tip:"Đang tải..."}):a("iframe",{src:C,width:"100%",height:"100%",title:"Preview PDF"})})})]})})]})]})})}const se=[{type:"signReports.signReportUpload.defaultReport",value:1},{type:"signReports.signReportUpload.manualReport",value:2}],me=c=>{var F,n;const[l]=A(),{haveNotForm:u}=c,{model:g,dispatch:f,repository:t,errorMessage:v,requestId:N,setErrorMessage:U}=r.useContext(I),[s,h]=r.useState(!1),C=r.useRef(null),{notifyUpdateItemSuccess:o,notifyUpdateItemError:d}=le.useCRUDMessage(),y=r.useCallback(e=>{e.currentTarget.value=""},[]),D=r.useCallback(()=>{const e=C.current;e&&e.click()},[]);r.useEffect(()=>{u&&f({type:"UPDATE",payload:{formType:2}})},[f,u]);const R=r.useCallback((e,i=!1)=>{const m=(i===!0?e.dataTransfer.files:e.currentTarget.files)[0];t.uploadFile(m).subscribe({next:b=>{b&&(f({type:"UPDATE",payload:{attachment:b,signatureConfigurations:[]}}),U([]))}})},[f,t,U]),x=r.useCallback(e=>{f({type:"UPDATE",payload:{formType:e.target.value}})},[f]),w=r.useCallback(e=>{e.preventDefault(),e.stopPropagation(),e.type==="dragenter"||e.type==="dragover"?h(!0):e.type==="dragleave"&&h(!1)},[]),P=r.useCallback(e=>{e.preventDefault(),e.stopPropagation(),R(e,!0),h(!1)},[R]),k=r.useCallback((e,i)=>{t.uploadFile(e).subscribe({next:p=>{p&&(o(),f({type:"UPDATE",payload:{attachment:p,signatureConfigurations:[],dynamicTemplate:{...i}}}),U([]))},error:()=>{d()}})},[f,t,U,o,d]);return a(j,{style:{height:"calc(100vh - 240px)"},children:a(S,{span:24,style:{height:"100%"},children:a("div",{className:"sign-report",children:T("div",{className:"sign-report__wrapper",children:[T("div",{children:[a("p",{className:"sign-report__title",children:l("signReports.signReportUpload.title")}),a("p",{className:"sign-report__description",children:l("signReports.signReportUpload.description")})]}),a(M.Group,{value:g.formType,onChange:x,children:a(ee,{direction:"vertical",children:se.map((e,i)=>a(M,{value:e.value,disabled:i===0&&u,children:l(e.type)},e.value))})}),g.formType===1&&a("div",{className:"dynamic-template-container w-100",children:a(re,{getListFileTemplates:t.dynamicTemplateList,previewFileTemplate:t.dynamicTemplatePreview,downloadFileTemplatePdf:t.dynamicTemplateDownloadPdf,downloadFileTemplateOriginal:t.dynamicTemplateDownloadOriginal,saveFileTemplate:k,requestId:N,fileTemplate:g.dynamicTemplate})}),g.formType===2&&T("div",{className:"uploader-container w-100",children:[T("div",{className:"sign-report-uploader",children:[a("p",{className:"sign-report-uploader__name",children:l("signReports.signReportUpload.report")}),a("p",{className:"sign-report-uploader__rule",children:l("signReports.signReportUpload.fileWarning")})]}),T("form",{id:"form-file-upload",onDragEnter:w,onSubmit:e=>e.preventDefault(),children:[a("input",{ref:C,type:"file",id:"input-file-upload",onChange:R,onClick:y,accept:".pdf"}),a("label",{id:"label-file-upload",htmlFor:"input-file-upload",className:s?"drag-active":"",children:T("div",{children:[g.attachment&&((F=g.attachment)!=null&&F.name)?a("p",{children:(n=g.attachment)==null?void 0:n.name}):a("p",{children:"Drag and drop your file here or"}),a("button",{className:"upload-button",onClick:D,children:"Upload a file"})]})}),s&&a("div",{id:"drag-file-element",onDragEnter:w,onDragLeave:w,onDragOver:w,onDrop:P}),a("div",{className:"w-100",children:v&&v.length>0&&v.map(e=>a("div",{className:"mt-3 mb-3 pl-2 text-danger",children:e},e))})]})]})]})})})})};export{me as default};
