var ee=Object.defineProperty;var te=(e,t,n)=>t in e?ee(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var u=(e,t,n)=>(te(e,typeof t!="symbol"?t+"":t,n),n);import{r as z,R as r,j as $,c as l,u as L,F as ne,W as ie}from"./index-ac046c6e.js";import{P as ae,A as T,J as B,r as J,ib as W,ic as H}from"./http-37dced0c.js";import{h as oe,r as se,i as re,u as Z,g as V,j as G,x as le,d as de,f as U,S as ce,L as ge,k as X,e as he,v as ue,R as pe,c as Y}from"./AppRoot-28bbac62.js";const me=e=>{const{componentCls:t,sizePaddingEdgeHorizontal:n,colorSplit:o,lineWidth:i,textPaddingInline:c,orientationMargin:s,verticalMarginInline:g}=e;return{[t]:Object.assign(Object.assign({},se(e)),{borderBlockStart:`${T(i)} solid ${o}`,"&-vertical":{position:"relative",top:"-0.06em",display:"inline-block",height:"0.9em",marginInline:g,marginBlock:0,verticalAlign:"middle",borderTop:0,borderInlineStart:`${T(i)} solid ${o}`},"&-horizontal":{display:"flex",clear:"both",width:"100%",minWidth:"100%",margin:`${T(e.dividerHorizontalGutterMargin)} 0`},[`&-horizontal${t}-with-text`]:{display:"flex",alignItems:"center",margin:`${T(e.dividerHorizontalWithTextGutterMargin)} 0`,color:e.colorTextHeading,fontWeight:500,fontSize:e.fontSizeLG,whiteSpace:"nowrap",textAlign:"center",borderBlockStart:`0 ${o}`,"&::before, &::after":{position:"relative",width:"50%",borderBlockStart:`${T(i)} solid transparent`,borderBlockStartColor:"inherit",borderBlockEnd:0,transform:"translateY(50%)",content:"''"}},[`&-horizontal${t}-with-text-start`]:{"&::before":{width:`calc(${s} * 100%)`},"&::after":{width:`calc(100% - ${s} * 100%)`}},[`&-horizontal${t}-with-text-end`]:{"&::before":{width:`calc(100% - ${s} * 100%)`},"&::after":{width:`calc(${s} * 100%)`}},[`${t}-inner-text`]:{display:"inline-block",paddingBlock:0,paddingInline:c},"&-dashed":{background:"none",borderColor:o,borderStyle:"dashed",borderWidth:`${T(i)} 0 0`},[`&-horizontal${t}-with-text${t}-dashed`]:{"&::before, &::after":{borderStyle:"dashed none none"}},[`&-vertical${t}-dashed`]:{borderInlineStartWidth:i,borderInlineEnd:0,borderBlockStart:0,borderBlockEnd:0},"&-dotted":{background:"none",borderColor:o,borderStyle:"dotted",borderWidth:`${T(i)} 0 0`},[`&-horizontal${t}-with-text${t}-dotted`]:{"&::before, &::after":{borderStyle:"dotted none none"}},[`&-vertical${t}-dotted`]:{borderInlineStartWidth:i,borderInlineEnd:0,borderBlockStart:0,borderBlockEnd:0},[`&-plain${t}-with-text`]:{color:e.colorText,fontWeight:"normal",fontSize:e.fontSize},[`&-horizontal${t}-with-text-start${t}-no-default-orientation-margin-start`]:{"&::before":{width:0},"&::after":{width:"100%"},[`${t}-inner-text`]:{paddingInlineStart:n}},[`&-horizontal${t}-with-text-end${t}-no-default-orientation-margin-end`]:{"&::before":{width:"100%"},"&::after":{width:0},[`${t}-inner-text`]:{paddingInlineEnd:n}}})}},fe=e=>({textPaddingInline:"1em",orientationMargin:.05,verticalMarginInline:e.marginXS}),ye=oe("Divider",e=>{const t=ae(e,{dividerHorizontalWithTextGutterMargin:e.margin,dividerHorizontalGutterMargin:e.marginLG,sizePaddingEdgeHorizontal:0});return[me(t)]},fe,{unitless:{orientationMargin:!0}});var be=globalThis&&globalThis.__rest||function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(n[o[i]]=e[o[i]]);return n};const Se=e=>{const{getPrefixCls:t,direction:n,className:o,style:i}=re("divider"),{prefixCls:c,type:s="horizontal",orientation:g="center",orientationMargin:y,className:S,rootClassName:D,children:b,dashed:v,variant:x="solid",plain:p,style:N}=e,m=be(e,["prefixCls","type","orientation","orientationMargin","className","rootClassName","children","dashed","variant","plain","style"]),d=t("divider",c),[h,w,f]=ye(d),C=!!b,k=z.useMemo(()=>g==="left"?n==="rtl"?"end":"start":g==="right"?n==="rtl"?"start":"end":g,[n,g]),P=k==="start"&&y!=null,_=k==="end"&&y!=null,R=B(d,o,w,f,`${d}-${s}`,{[`${d}-with-text`]:C,[`${d}-with-text-${k}`]:C,[`${d}-dashed`]:!!v,[`${d}-${x}`]:x!=="solid",[`${d}-plain`]:!!p,[`${d}-rtl`]:n==="rtl",[`${d}-no-default-orientation-margin-start`]:P,[`${d}-no-default-orientation-margin-end`]:_},S,D),E=z.useMemo(()=>typeof y=="number"?y:/^\d+$/.test(y)?Number(y):y,[y]),a={marginInlineStart:P?E:void 0,marginInlineEnd:_?E:void 0};return h(z.createElement("div",Object.assign({className:R,style:Object.assign(Object.assign({},i),N)},m,{role:"separator"}),b&&s!=="vertical"&&z.createElement("span",{className:`${d}-inner-text`,style:a},b)))},we=Se;class q extends J.ModelFilter{constructor(){super(...arguments);u(this,"code");u(this,"name");u(this,"status");u(this,"workflowTypeId");u(this,"workflowDefinitionId");u(this,"activityCode");u(this,"workflowActivityId");u(this,"createdDate");u(this,"createdUser")}}const ve=l(ge,{style:{fontSize:24},spin:!0}),xe=({currentContent:e,updateContent:t,updateAttachment:n,requestId:o,requestField:i,requestFormConfiguration:c,repository:s,haveDigitalSigining:g})=>{var h;const[y,S]=r.useState(!1),[D,b]=r.useState(null),[v,x]=r.useState(null),p=r.useCallback(w=>{const f={...e};f.signatureDisplayType=w.target.value,t(f),n(f)},[e,n,t]),N=r.useCallback((w,f)=>{const C={...e};C.approvalActorCode=f?f==null?void 0:f.code:void 0,C.approvalActorId=w??void 0,C.previewDisplay=f==null?void 0:f.actorIdentityDisplayName,t(C),n(C)},[e,n,t]),[m]=Z(),d=[{type:m("signReports.type1"),value:1},{type:m("signReports.type2"),value:2}];return $("div",{className:"information-signature",children:[l("p",{className:"information-signature__title",children:m("signReports.signInfor")}),$(V,{direction:"vertical",size:20,style:{width:"100%"},children:[l(G,{validateStatus:v,message:D,children:l(le,{classFilter:q,placeHolder:m("signReports.placeHolder.wf"),getList:s.listActor,onChange:N,value:e.workflowStep,searchProperty:"search",searchType:null,valueFilter:{...new q,id:o}})}),l(G,{children:l(de,{label:m("signReports.role"),value:((h=e.workflowStep)==null?void 0:h.name)??"",placeHolder:m("signReports.placeHolder.role"),disabled:!0})}),e.formType===1&&l(U.Group,{value:e.signatureDisplayType,onChange:p,children:l(V,{direction:"vertical",children:d.map(w=>l(U,{value:w.value,children:w.type},w.value))})})]}),y&&l("div",{className:"overlay-zone d-flex justify-content-center align-items-center",children:l(ce,{indicator:ve})})]})},Ce=({id:e,page:t,dimensions:n,updateDimensions:o,addText:i,pageIndex:c})=>{const s=r.useRef(null),[g,y]=r.useState(n&&n.width||0),[S,D]=r.useState(n&&n.height||0);console.log("check canvas check drop");const b=r.useCallback(v=>{var m;console.log("check droppp image");const x=JSON.parse(v.dataTransfer.getData("dragPosition")||{}),p=(m=s.current)==null?void 0:m.getBoundingClientRect(),N={xCoordinate:v.clientX-p.left,yCoordinate:v.clientY-p.top,formType:x.typeId||1,pageIndex:c};i(N)},[i,c]);return r.useEffect(()=>{(async x=>{var N,m;const p=await x;if(p){const d=(N=s.current)==null?void 0:N.getContext("2d"),h=p.getViewport({scale:1});if(y(h.width),D(h.height),d){await p.render({canvasContext:(m=s.current)==null?void 0:m.getContext("2d"),viewport:h}).promise;const w={width:h.width,height:h.height};o(w)}}})(t)},[t,o]),l("canvas",{id:e,ref:s,width:g,height:S,onDrop:b,onDragOver:v=>v.preventDefault()})};const Me=({text:e,width:t,height:n,mode:o,positionTop:i,positionLeft:c,formType:s,handleMouseDown:g,handleMouseMove:y,handleMouseOut:S,handleMouseUp:D,deleteSignature:b,updateSignature:v,onClick:x})=>{const[p,N]=r.useState({x:t,y:n}),m=r.useCallback(d=>{const h=p,w={x:d.pageX,y:d.pageY};d.stopPropagation();function f(k){k.stopPropagation();const P=h.x-w.x+k.pageX,_=h.y-w.y+k.pageY;N(()=>({x:P,y:_})),v({xCoordinate:c,yCoordinate:i,width:P,height:_})}function C(){document.body.removeEventListener("mousemove",f)}document.body.addEventListener("mousemove",f),document.body.addEventListener("mouseup",C,{once:!0})},[c,i,p,v]);return $("div",{onMouseDown:g,onMouseMove:y,onMouseUp:D,onMouseOut:S,onClick:x,className:B("signature-box",{orange:s===2}),style:{cursor:o===W.COMMAND?"move":"default",top:i,left:c,wordWrap:"break-word",padding:0,position:"absolute",width:p.x,height:p.y},tabIndex:0,children:[l("div",{className:"signature-box__text",onMouseDown:()=>!1,children:e}),l(X,{type:"primary",style:{},className:"signature-box__delete-button",size:"small",onClick:b,children:"X"}),l(X,{type:"primary",onMouseDown:m,className:"signature-box__resize-button",size:"small",children:l("span",{className:"glyphicon glyphicon-resize-full"})})]})},De=({formType:e,xCoordinate:t,yCoordinate:n,text:o,width:i,height:c,pageHeight:s,pageWidth:g,removeSignature:y,updateTextAttachment:S,getAttachment:D})=>{const b=z.useRef(null),[v,x]=z.useState(!1),[p,N]=z.useState(n),[m,d]=z.useState(t),[h,w]=z.useState(H.NO_MOVEMENT),[f]=z.useState(W.COMMAND),C=a=>{if(a.preventDefault(),v){const{top:M,left:O}=L.getMovePosition(m,p,a.movementX,a.movementY,i,c,g,s);N(M),d(O)}},k=()=>{f===W.COMMAND&&(x(!0),w(H.MOVE))},P=a=>{if(a.preventDefault(),f===W.COMMAND){if(x(!1),h===H.MOVE){const{top:M,left:O}=L.getMovePosition(m,p,a.movementX,a.movementY,i,c,g,s);S({xCoordinate:O,yCoordinate:M,width:i,height:c})}w(H.NO_MOVEMENT)}};return l(Me,{formType:e,text:o,width:i,height:c,mode:f,inputRef:b,onClick:()=>{D()},positionTop:p,positionLeft:m,handleMouseUp:P,handleMouseOut:a=>{h===H.MOVE&&P(a)},handleMouseDown:k,handleMouseMove:C,deleteSignature:()=>{y()},updateSignature:S})},Ne=({pageDimensions:e,getAttachment:t,removeAttachment:n,updateAttachment:o,attachments:i})=>{const c=r.useCallback(s=>({xCoordinate:g,yCoordinate:y,height:S,width:D})=>{const b={...s};b.xCoordinate=g,b.yCoordinate=y,b.height=S,b.width=D,o(b)},[o]);return i?l(ne,{children:i.length?i.map(s=>{const g=s.id?s.id:s.rowId;return $(r.Fragment,{children:[" ",l(De,{...s,pageWidth:e.width,pageHeight:e.height,removeSignature:()=>n(s),updateTextAttachment:c(s),getAttachment:()=>t(s),text:s.previewDisplay??(s.formType===1?"Chữ ký ảnh":"Chữ ký số")})]},g)}):null}):null};class $e extends J.Model{constructor(){super(...arguments);u(this,"id");u(this,"RequestFormConfigurationId");u(this,"workflowDefinitionId");u(this,"workflowStateId");u(this,"signatureDisplayType",1);u(this,"xCoordinate");u(this,"yCoordinate");u(this,"page");u(this,"height");u(this,"width");u(this,"text");u(this,"signatureType");u(this,"workflowDefinition")}}const Ie="/assets/image-26309be9.svg",ke="/assets/code-signing-service-d7600071.svg",Oe={async readAsPDF(e){const t=await ie.getAsset("pdfjsLib"),n=window.URL.createObjectURL(e);return t.getDocument(n).promise},usePdf(){const[e,t]=r.useState({x:0,y:0,width:0,height:0}),[n,o]=r.useState([]),i=r.useCallback(t,[t]),c=r.useCallback(({pages:s})=>{o(s)},[]);return{dimensions:e,setDimensions:i,pages:n,initialize:c}}},Pe=()=>{const[e,t]=r.useState({x:0,y:0,width:0,height:0}),[n,o]=r.useState([]),i=r.useCallback(t,[t]),c=r.useCallback(({file:s,pages:g})=>{o(g)},[]);return{dimensions:e,setDimensions:i,pages:n,initialize:c}},Re=()=>{var R,E;const{model:e,dispatch:t,requestId:n,requestField:o,repository:i,errorMessage:c,haveDigitalSigining:s}=r.useContext(he),[g,y]=r.useState(),[S,D]=r.useState((R=e==null?void 0:e.signatureConfigurations)==null?void 0:R.length),[b,v]=r.useState(0),[x]=Z(),{initialize:p,pages:N,setDimensions:m,dimensions:d}=Pe();r.useEffect(()=>{i.listActor({id:n}).subscribe(a=>{v((a==null?void 0:a.length)||0)})},[i,o,n]);const h=r.useMemo(()=>({width:d.width,height:d.height}),[d.width,d.height]),w=r.useCallback(({xCoordinate:a,yCoordinate:M,formType:O,pageIndex:F})=>{const I=new $e;I.rowId=ue(),I.xCoordinate=a,I.yCoordinate=M,I.width=156,I.height=90,I.page=F,I.formType=O,t({type:"ADD_CONTENT",payload:{signatureConfigurations:[I]}}),D(S+1)},[t,S]),f=r.useCallback(a=>{t({type:"REMOVE_CONTENT",payload:{signatureConfigurations:[a]}}),D(S-1)},[t,S]),C=r.useCallback(a=>{t({type:"UPDATE_CONTENT",payload:{signatureConfigurations:[a]}})},[t]),k=r.useCallback(a=>{y({...a})},[]),P=r.useCallback(a=>{const M={x:a.clientX,y:a.clientY,typeId:1};a.dataTransfer.setData("dragPosition",JSON.stringify(M))},[]),_=r.useCallback(a=>{const M={x:a.clientX,y:a.clientY,typeId:2};a.dataTransfer.setData("dragPosition",JSON.stringify(M))},[]);return r.useEffect(()=>{var a,M,O;if((a=e==null?void 0:e.attachment)!=null&&a.systemFileId){const F=async A=>{try{const j=await Oe.readAsPDF(A),K={file:A,pages:Array(j.numPages).fill(0).map((ze,Q)=>j.getPage(Q+1))};p(K)}catch{throw new Error("Failed to load PDF")}},I=i.getFile((O=(M=e==null?void 0:e.attachment)==null?void 0:M.systemFileId)==null?void 0:O.toString()).subscribe({next:A=>{const j=new Blob([A.data],{type:"application/pdf"});F(j)}});return()=>{I.unsubscribe()}}},[p,(E=e==null?void 0:e.attachment)==null?void 0:E.systemFileId,i]),r.useEffect(()=>{h.width>0&&h.height>0&&t({type:"UPDATE_SIZE_DIMENSION",payload:{elementHeight:h.height,elementWidth:h.width}})},[t,h.height,h.width]),$(pe,{children:[$(Y,{span:17,children:[l("div",{style:{maxHeight:"calc(100vh - 240px)",overflow:"scroll"},children:N.map((a,M)=>{var I;const O=M+1,F=e.signatureConfigurations&&e.signatureConfigurations.length>0?e.signatureConfigurations.filter(A=>A.page===O):[];return $("div",{className:"page-pdf__container",children:[l(Ce,{id:"canvas",page:a,pageIndex:M+1,dimensions:d,updateDimensions:m,addText:w}),l(Ne,{attachments:F,pdfName:(I=e==null?void 0:e.attachment)==null?void 0:I.name,pageDimensions:d,removeAttachment:f,updateAttachment:C,getAttachment:k})]},O)})}),l("div",{className:"w-100",children:c&&c.length>0&&c.map(a=>l("div",{className:"mt-3 mb-3 pl-2 text-danger",children:a},a))})]}),l(Y,{span:7,children:$("div",{className:"sign-process-master-action",children:[l(we,{type:"vertical",style:{height:"calc(100vh - 240px)"}}),$("div",{className:"sign-process-master-action__wrapper",children:[l("p",{className:"sign-process-master-action__title",children:x("signReports.signArea")}),$("div",{className:"sign-process-master-action__content",children:[$("div",{className:B("sign-process-master-action__button d-flex flex-column ",b>S?"pointer":"no-drop"),draggable:b>S,onDragStart:P,children:[$("div",{className:"button__title",children:[l("img",{src:Ie,alt:"IMG",height:24,width:24}),l("span",{children:x("signReports.signImage")})]}),l("div",{className:"triangle"})]}),s&&$("div",{className:B("sign-process-master-action__button orange d-flex flex-column ",b>S?"pointer":"no-drop"),draggable:b>S,onDragStart:_,children:[$("div",{className:"button__title",children:[l("img",{src:ke,alt:"IMG",height:24,width:24}),l("span",{children:x("signReports.signDigital")})]}),l("div",{className:"triangle orange"})]})]}),g?l(xe,{requestFormConfiguration:e,currentContent:g,updateContent:y,updateAttachment:C,requestId:n,requestField:o,repository:i,haveDigitalSigining:s}):null]})]})})]})};export{Re as default};
